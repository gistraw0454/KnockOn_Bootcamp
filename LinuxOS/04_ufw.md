# π 04. ufw
## π’΅ λ°©ν™”λ²½κ³Ό λ¦¬λ…μ¤ λ°©ν™”λ²½ μ‹μ¤ν… UFW
1. **IP, PORT μ΄λ€?**
    - IP (Internet Protocol)
        - μ»΄ν“¨ν„° λ„¤νΈμ›ν¬μ—μ„ ν†µμ‹ μ— μ‚¬μ©λλ” ν”„λ΅ν† μ½
        - λ„¤νΈμ›ν¬μ— μ—°κ²°λ κ° κΈ°κΈ°λ¥Ό μ‹λ³„ν•λ”λ° μ‚¬μ©
        - IPv4, IPv6
    - ν¬νΈ (Port)
        - μ»΄ν“¨ν„° λ‚΄μ—μ„ νΉμ • ν”„λ΅μ„Έμ¤λ‚ μ„λΉ„μ¤λ¥Ό μ‹λ³„ν•λ”λ° μ‚¬μ©
        - λ„¤νΈμ›ν¬ ν†µμ‹ μ€ μ†΅μ‹ μμ™€ μμ‹ μ κ°„μ IP μ£Όμ† λΏ μ•„λ‹λΌ ν¬νΈ λ²νΈλ„ ν¬ν•¨ν•μ—¬ μ΄λ£¨μ–΄μ§
        - 0~ 65535 
            - well-known ports (0~1023)
            - registered ports (1024~49151) : λ“±λ΅λ μ„λΉ„μ¤κ°€ ν• λ‹Ή
            - dynamic or private ports (49152 ~ 65535) ν΄λΌμ΄μ–ΈνΈ ν”„λ΅κ·Έλ¨μ΄ μ‚¬μ©

2. **λ‚΄λ¶€ IP, μ™Έλ¶€ IP**
    - λ‚΄λ¶€ IP
        - λ΅μ»¬ λ„¤νΈμ›ν¬ λ‚΄μ—μ„ μ‚¬μ©λλ” IPμ£Όμ†, λ΅μ»¬ λ„¤νΈμ›ν¬μ— μ—°κ²°λ κ° κΈ°κΈ°μ— ν• λ‹Ή
        - μ™Έλ¶€ λ„¤νΈμ›ν¬ (μΈν„°λ„·) μ—μ„λ” μ§μ ‘μ μΌλ΅ μ ‘κ·Ό x
    - μ™Έλ¶€ IP
        - μΈν„°λ„·μ— μ—°κ²°λ κ° κΈ°κΈ°μ— ν• λ‹Ήλλ” κ³ μ  IP μ£Όμ†
        - μΈν„°λ„· μ„λΉ„μ¤ μ κ³µμ—…μ²΄ ISP μ— μν•΄ ν• λ‹Ήλλ©° κ³µκ°μ  μ ‘κ·Όκ°€λ¥
        - ISPμ— λ”°λΌ λ‹¤λ¥Όμ μμ

    > λ‚΄λ¶€IP : λ΅μ»¬ λ„¤νΈμ›ν¬ λ‚΄μ—μ„ ν†µμ‹ μ— μ‚¬μ©, μ™Έλ¶€IP : μΈν„°λ„· ν†µμ‹ μ— μ‚¬μ©

3. **λ°©ν™”λ²½ (Firewall) μ΄λ€?**

    - μ‹ λΆ°ν•  μ μλ” λ‚΄λ¶€ λ„¤νΈμ›ν¬μ™€ μ‹ λΆ°ν•  μ μ—†λ” μ™Έλ¶€ λ„¤νΈμ›ν¬ κ°„μ μ¥λ²½μ„ κµ¬μ„± 
    - μ„λ΅ λ‹¤λ¥Έ λ„¤νΈμ›ν¬λ¥Ό μ§€λ‚λ” λ°μ΄ν„°λ¥Ό ν—μ© λ° κ±°λ¶€, κ²€μ—΄, μμ •ν•λ” μ†ν”„νΈμ›¨μ–΄ λλ” κ·Έλ° μ†ν”„νΈμ›¨μ–΄λ¥Ό κµ¬λ™μ‹ν‚¤λ” ν•λ“μ›¨μ–΄ μ¥μΉ

        <ins>μ™Έλ¶€ μ‚¬μ©μλ“¤μ΄ λ‚΄λ¶€λ„¤νΈμ›ν¬μ— μ ‘κ·Όν•μ§€ λ»ν•λ„λ΅ λ‚΄λ¶€ λ„¤νΈμ›ν¬λ¥Ό λ°©μ–΄ν•κΈ° μ„ν• μ†”λ£¨μ… !</ins>
    
        ![alt text](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FboZPAV%2FbtrkhomGIMr%2FII7laCCwALwGkTlFKKmIOk%2Fimg.png)
    
    1. 1μ„Έλ€ : ν¨ν‚· ν•„ν„°λ§ λ°©ν™”λ²½
        - λ―Έλ¦¬ μ •ν•΄μ§„ κ·μΉ™μ— λ”°λΌ ν¨ν‚·μ μ¶λ°μ§€ λ° λ©μ μ§€ <ins>IP μ£Όμ†</ins> μ •λ³΄μ™€ κ° μ„λΉ„μ¤μ <ins>ν¬νΈ λ²νΈ</ins>λ¥Ό μ΄μ©ν•μ—¬ <ins>ν¨ν‚·λ‹¨μ„</ins>λ΅ μ ‘μ† μ μ–΄
    2. 2μ„Έλ€ : μ¤ν…μ΄νΈν’€ μΈμ¤ν™μ… λ°©ν™”λ²½
        - <ins>μ„Έμ…μ„ λ§Ίμ€ ν¨ν‚·μ„ μ²λ¦¬.</ins> ν¨ν‚· ν•„ν„°λ§ κΈ°μ μ„ μ‚¬μ©ν•μ—¬ ν¨ν‚·μ •λ³΄λ¥Ό κ²€ν† ν•κ³  <ins>TCPμ—°κ²°μ— κ΄€ν• μ •λ³΄λ¥Ό κΈ°λ΅</ins>ν•κ³  μ΄λ¥Ό ν† λ€λ΅ ν¨ν‚·μ„ μ°¨λ‹¨ / ν—μ©.
    3. 3μ„Έλ€ : μ• ν”λ¦¬μΌ€μ΄μ… λ°©ν™”λ²½ (IPS, WAF, UTM)
        - ν¨ν‚· λ‚΄μ©μ„ κ²€μ‚¬ν•κ³  TCP λ°μ΄ν„°μ—μ„ κ° μ• ν”λ¦¬μΌ€μ΄μ… ν—¤λ”λ¥Ό ν™•μΈν•μ—¬ μ—ν”λ¦¬μΌ€μ΄μ…μ— λ―ΈμΉλ” μν–¥μ„ λ¶„μ„ν•¨.
    
4. **IP, PORT ν™•μΈ λ°©λ²• (ifconfig, netstat)**
    ### ifconfig
    > install : `sudo apt install net-tools -y`
    - <ins>λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤μ μƒνƒλ¥Ό λ³΄μ—¬μ£Όκ³ , ν•΄λ‹Ή μΈν„°νμ΄μ¤μ— ν• λ‹Ήλ IP μ£Όμ†λ¥Ό ν™•μΈν•λ”λ° μ‚¬μ©</ins>
        
        ```cmd
        ifconfig [-a] [-v] [-s] <interface> [[<AF>] <address>]
        ```
        ifconfigμΌλ΅ μ„¤μ •λ κµ¬μ„±μ€ μκµ¬μ μ΄μ§€ μ•μ. 

        λ£¨νΈλλ” sudo κ¶ν•μ΄μμ–΄μ•Ό λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤λ¥Ό κµ¬μ„± ν•  μ μμ.

        `ifconfig` : λ¨λ“  λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤ λ° κ΄€λ ¨ IP μ£Όμ†μ κµ¬μ„± μ •λ³΄ ν‘μ‹
        `ifconfig -a` : λ¨λ“  ν™μ„± λ° λΉ„ν™μ„± λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤μ— λ€ν• μ •λ³΄ ν¬ν•¨
        `ifconfig eth0` : νΉμ • λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤μ κµ¬μ„±μ •λ³΄λ¥Ό ν‘μ‹
     
     - <ins>λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤μ— IP μ£Όμ† λ° λ„·λ§μ¤ν¬ ν• λ‹Ή κ°€λ¥</ins>
        ```cmd
        ifconfig [interface-name] [ip-address] netmask [subnet-mask]
        ```
        
        ```cmd
        ex)
            # μΈν„°νμ΄μ¤ eth0μ— IPμ£Όμ† 192.168.0.101 λ° λ„·λ§μ¤ν¬ 255.255.0.0μ„ ν• λ‹Ήν•κΈ°
            ifconfig eth0 192.168.0.101 netmask 255.255.0.0

            # μΈν„°νμ΄μ¤ λ³„μΉ­μΌλ΅ λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤μ— λ³΄μ΅° IPμ£Όμ† ν• λ‹Ήν•κΈ°
            ifconfig eth0:0 192.168.0.102 netmask 255.255.0.0
        ```
    - <ins>λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•κ±°λ‚ μ‚¬μ©ν•μ§€ μ•λ„λ΅ μ„¤μ •</ins>

        λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤λ¥Ό μ¬μ„¤μ • ν•΄μ•Όν• λ•
        ```cmd
        ex)
            # ν™μ„± λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•μ§€ μ•λ„λ΅ μ„¤μ •
            ifconfig eth0 down  

            # λΉ„ν™μ„± λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•λ„λ΅ μ„¤μ •
            ifconfig eth0 up
        ```
    
    - <ins>λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤μ MTU μ£Όμ† λ³€κ²½</ins>
        
        MTU μµλ€μ „μ†΅λ‹¨μ„λ¥Ό μ‚¬μ©ν•λ©΄ μΈν„°νμ΄μ¤μ—μ„ μ „μ†΅λλ” ν¨ν‚·μ ν¬κΈ°λ¥Ό μ ν• ν•  μ μλ‹¤.
        ```cmd
        ifconfig [interface-name] mtu [mtu-value]
        ```
        ```cmd
        ex)
            # λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤μ MTU κ°’μ„ 500μΌλ΅ μ„¤μ •
            ifconfig eth0 mtu 500
        ```
    - <ins>λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤μ MAC μ£Όμ† λ³€κ²½</ins>
        
        MAC λ―Έλ””μ–΄ μ•΅μ„Έμ¤ μ μ–΄λ” λ„¤νΈμ›ν¬μ—μ„ μ¥μΉλ¥Ό κ³ μ ν•κ² μ‹λ³„ν•λ”λ¬Όλ¦¬μ  μ£Όμ†.
        ```cmd
        ex)
            ifconfig eth0 hw ether 00:00:2d:3a:2a:28
        ```

        ### netstat
        - λ„¤νΈμ›ν¬ μ—°κ²° λ° λΌμ°ν… ν…μ΄λΈ”μ„ λ³΄μ—¬μ£Όλ”λ° μ‚¬μ©
        - ν„μ¬ μ‹μ¤ν…μ—μ„ μμ‹  μ†΅μ‹  λλ” λ„¤νΈμ›ν¬ μ—°κ²°μ μƒνƒμ™€ ν¬νΈλ¥Ό ν™•μΈν•λ”λ° μ μ©
        - `-t` : TCP μ—°κ²° μ •λ³΄ ν‘μ‹
        - `-u` : UDP μ—°κ²° μ •λ³΄ ν‘μ‹
        - `-a` : λ¨λ“  μ—°κ²° μ •λ³΄ ν‘μ‹
        - `-l` : λ¦¬μ¤λ‹ μƒνƒμΈ μ†μΌ“λ§ ν‘μ‹
        - `-n` : μ«μλ΅ ν‘μ‹ (νΈμ¤νΈμ΄λ¦„μ„ μ«μλ΅ λ³€ν™ν•μ§€ μ•κ³  IP μ£Όμ† μμ²΄λ¥Ό μ¶λ ¥)

        ```cmd
        # λ¨λ“  μ—°κ²° λ° ν¬νΈ ν™•μΈ
        netstat -tuln

        # λ¦¬μ¤λ‹ μƒνƒμΈ TCP ν¬νΈ ν‘μ‹
        netstat -tln

        # νΉμ • ν”„λ΅ν† μ½μ— λ€ν• μ—°κ²° λ° ν¬νΈ ν™•μΈ (TCP)
        netstat -tuln | grep "tcp"

        # νΉμ • ν¬νΈλ¥Ό μ‚¬μ©ν•λ” μ—°κ²° ν™•μΈ (Port 80)
        netstat -tuln | grep ":80"
        ```
5. **UFW λ‹¤μ΄λ΅λ“ λ° μ‚¬μ© λ°©λ²•**
    
    UFW (Uncomplicated Firewall)

    - Ubuntu λ¦¬λ…μ¤ μ‹μ¤ν…μ—μ„ μ‚¬μ©λλ” κ°„λ‹¨ν• λ°©ν™”λ²½ κµ¬μ„± ν΄
    - ufwμ—μ„ λ°©ν™”λ²½ κ·μΉ™μ„ μ¶”κ°€ν•λ©΄ IPv4μ™€ IPv6 κ·μΉ™μ„ μλ™μΌλ΅ μ¶”κ°€ν•΄μ¤
    - λ„¤νΈμ›ν¬ νΈλν”½μ„ μ μ–΄ν•κ³  λ°©ν™”λ²½ κ·μΉ™μ„ μ„¤μ • κ°€λ¥
    

        `sudo ufw enable` : λ°©ν™”λ²½ ν™μ„±ν™”
        
        `sudo ufw disable` : λ°©ν™”λ²½ λΉ„ν™μ„±ν™”
        
        ![alt text](image-1.png)

    - κΈ°λ³Έλ£° : λ“¤μ–΄μ¤λ” ν¨ν‚·μ— λ€ν•΄μ„λ” μ „λ¶€ deny , λ‚κ°€λ” ν¨ν‚·μ— λ€ν•΄μ„λ” μ „λ¶€ allow

        `sudo ufw show raw` : κΈ°λ³Έ λ£° ν™•μΈ

        `sudo ufw default deny` : κΈ°λ³Έ μ •μ±… μ°¨λ‹¨

        `sudo ufw default allow` : κΈ°λ³Έ μ •μ±… ν—μ©
    
    - UFW ν—μ© 
        ```cmd
        sudo ufw allow <port>/<optional: protocal>
        ```
        ![alt text](image-3.png)

    - UFW κ±°λ¶€
        ```cmd
        sudo ufw deny <port>/<optional: protocol>
        ```
        ![alt text](image-4.png)
    
    - UFW λ£° μ‚­μ 
        ![alt text](image-5.png)

    - service λ…μ„ μ΄μ©ν• μ„¤μ •

        `less /etc/services` : μ„λΉ„μ¤λ… λ³΄κΈ°
        ```cmd
        sudo ufw allow <service name>
        ```
        ![alt text](image-6.png)
    
    - νΉμ • IP μ£Όμ† ν—μ©/κ±°λ¶€
        ```bash
        sudo ufw allow from <ip address>
        ```

        ![alt text](image-7.png)
    
    - νΉμ • IP μ£Όμ†μ™€ μΌμΉν•λ” ν¬νΈ ν—μ©/κ±°λ¶€
        ```cmd
        sudo ufw allow from <ip address> to <protocol> port <port number>
        ```
        ![alt text](image-8.png)
    - νΉμ • IP μ£Όμ†μ™€ ν”„λ΅ν† μ½, ν¬νΈ ν—μ©/κ±°λ¶€
        ```
        sudo ufw allow from <ip address> to <protocol> port <port number> proto <protocol name>
        ```
        ![alt text](image-9.png)

    μ¶”μ² λ°©ν™”λ²½ μ •μ±…
    ![alt text](image-10.png)

## π”¥ Challenge !
1. **λ¨λ“  ip μ ‘κ·Όμ„ λ§‰μ•μ„ λ• λ³€ν™”**
    1. μ™Έλ¶€λ΅μ μ ‘κ·Ό μ ν•
        - μ™Έλ¶€ μ‹μ¤ν…μ— SSH, HTTP, HTTPS λ“±κ³Ό κ°™μ€ μ„λΉ„μ¤μ— μ ‘κ·Όν•  μ μ—†λ‹¤.
        - μ™Έλ¶€μ—μ„μ ICMP ν¨ν‚·μ„ ν†µν• pingκ³Ό κ°™μ€ λ„¤νΈμ›ν¬ λ„κµ¬λ¥Ό μ‚¬μ©ν•μ—¬ μ‹μ¤ν…μ— λ€ν• μ—°κ²° μƒνƒλ¥Ό ν™•μΈν•  μ μ—†λ‹¤.
    2. λ΅μ»¬ μ„λΉ„μ¤ μ ‘κ·Όμ—λ” μν–¥μ΄ μ—†λ‹¤.
        - λ΅μ»¬μ—μ„ μ‹¤ν–‰μ¤‘μΈ μ„λΉ„μ¤μ— μν–¥μ—†μ. μ‹μ¤ν… λ‚΄λ¶€μ—μ„ μ„λΉ„μ¤μ— μ ‘κ·Ό ν•  μ μλ‹¤.
    3. μ‹μ¤ν… μμ²΄λ¥Ό μ •μƒ μ‘λ™
        - ufw κ°€ λ¨λ“  μ™Έλ¶€ μ ‘κ·Όμ„ μ°¨λ‹¨ν•λ” κ²ƒμ΄μ§€λ§, μ‹μ¤ν… μμ²΄λ” μ •μƒ μ‘λ™ν•λ‹¤. μ™Έλ¶€ μ„λΉ„μ¤μ— μμ΅΄ν•μ§€ μ•λ” μ„λ²„λ” μ΄λ° μ„¤μ •μ„ μ μ©ν•  μ μλ‹¤.
    4. μ™Έλ¶€μ—μ„μ κ³µκ²©μ΄λ‚ λ¶λ²•μ  μ ‘κ·Όμ„ λ§‰μ„ μ μλ‹¤.
2. **22λ² ν¬νΈ μ ‘κ·Όμ„ λ§‰μ•μ„ λ• λ³€ν™”**
    
    22λ²ν¬νΈλ” SSHμ„λΉ„μ¤μ— μ‚¬μ©λλ” κΈ°λ³Έ ν¬νΈ

    1. SSH μ ‘κ·Ό λ¶κ°€λ¥
        - μ™Έλ¶€μ—μ„ ssh ν΄λΌμ΄μ–ΈνΈλ¥Ό μ‚¬μ©ν•μ—¬ μ‹μ¤ν…μ— μ ‘μ† ν•  μ μ—†λ‹¤. ssh ν΄λΌμ΄μ–ΈνΈλ” 22λ² ν¬νΈλ¥Ό ν†µν•΄ ssh μ„λ²„μ™€ ν†µμ‹ ν•λ―€λ΅ ν•΄λ‹Ή ν¬νΈμ— λ€ν• μ ‘κ·Όμ΄ μ°¨λ‹¨λλ©΄ μ›κ²©μΌλ΅ μ‹μ¤ν…μ— μ ‘μ† ν•  μ μ—†λ‹¤.
    2. μ›κ²© κ΄€λ¦¬ μ ν•
        - ssh λ¥Ό μ‚¬μ©ν•μ—¬ μ›κ²©μΌλ΅ μ‹μ¤ν…μ„ κ΄€λ¦¬ν•λ κ²½μ°, ν•΄λ‹Ή λ°©λ²•μ΄ λ”μ΄μƒ μ‘λ™ ν•μ§€μ•κ²λλ‹¤. μ›κ²©μΌλ΅ μ‹μ¤ν…μ— μ ‘μ†ν•μ—¬ νμΌμ„ μ „μ†΅ν•κ±°λ‚ λ…λ Ή μ‹¤ν–‰ λ¶κ°€
    3. κ³µκ²©μκ°€ sshλ¥Ό ν†µν•΄ μ‹μ¤ν…μ— μ•΅μ„Έμ¤ν•λ” μ‹λ„λ¥Ό μ°¨λ‹¨
    4. λ‹¤λ¥Έ ν¬νΈ μ‚¬μ©κ°„μΌ
        - ssh μ„λΉ„μ¤λ¥Ό μ‚¬μ©ν•  μ μλ„λ΅ ν•λ ¤λ©΄ λ‹¤λ¥Έ ν¬νΈλ¥Ό μ‚¬μ©ν•μ—¬ ssh μ„λΉ„μ¤λ¥Ό κµ¬μ„±ν•΄μ•Όν•¨. 